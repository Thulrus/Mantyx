<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mantyx - App Orchestration</title>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header>
        <div class="header-content">
          <div class="logo-section">
            <img src="/static/logo.png" alt="Mantyx" class="logo" />
            <h1>Mantyx</h1>
          </div>
          <div class="header-actions">
            <button id="uploadBtn" class="btn btn-primary">
              <span>ðŸ“¤</span> Upload App
            </button>
            <button id="refreshBtn" class="btn btn-secondary">
              <span>ðŸ”„</span> Refresh
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main>
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-title">Total Apps</div>
            <div class="stat-value" id="totalApps">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Running</div>
            <div class="stat-value running" id="runningApps">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Enabled</div>
            <div class="stat-value enabled" id="enabledApps">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-title">Failed</div>
            <div class="stat-value failed" id="failedApps">0</div>
          </div>
        </div>

        <!-- Apps List -->
        <div class="section">
          <h2>Applications</h2>
          <div id="appsList" class="apps-grid">
            <!-- Apps will be dynamically loaded here -->
          </div>
        </div>
      </main>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Upload Application</h2>

        <div class="tabs">
          <button class="tab-btn active" data-tab="zip">ZIP Upload</button>
          <button class="tab-btn" data-tab="git">Git Repository</button>
        </div>

        <!-- ZIP Upload Tab -->
        <div id="zipTab" class="tab-content active">
          <form id="zipUploadForm">
            <div class="form-group">
              <label for="zipFile">ZIP File</label>
              <input
                type="file"
                id="zipFile"
                name="file"
                accept=".zip"
                required
              />
            </div>
            <div class="form-group">
              <label for="zipAppName">App Name</label>
              <input
                type="text"
                id="zipAppName"
                name="app_name"
                placeholder="my-app"
                required
              />
              <small>Unique identifier (lowercase, hyphens allowed)</small>
            </div>
            <div class="form-group">
              <label for="zipDisplayName">Display Name</label>
              <input
                type="text"
                id="zipDisplayName"
                name="display_name"
                placeholder="My Application"
                required
              />
            </div>
            <div class="form-group">
              <label for="zipAppType">App Type</label>
              <select
                id="zipAppType"
                name="app_type"
                required
                onchange="toggleScheduleFields('zip')"
              >
                <option value="PERPETUAL" selected>
                  Perpetual (Always Running)
                </option>
                <option value="SCHEDULED">Scheduled (Cron-based)</option>
              </select>
              <small
                >Perpetual apps run continuously, scheduled apps run on a
                schedule</small
              >
            </div>

            <!-- Schedule Fields (for SCHEDULED apps) -->
            <div
              id="zipScheduleFields"
              class="schedule-fields"
              style="display: none"
            >
              <div class="form-group">
                <label for="zipScheduleType">Schedule Type</label>
                <select
                  id="zipScheduleType"
                  name="schedule_type"
                  onchange="toggleScheduleInputs('zip')"
                >
                  <option value="interval" selected>
                    Interval (Every X minutes/hours)
                  </option>
                  <option value="cron">Cron Expression (Advanced)</option>
                </select>
              </div>

              <div id="zipIntervalFields">
                <div class="form-group">
                  <label for="zipIntervalValue">Interval Value</label>
                  <input
                    type="number"
                    id="zipIntervalValue"
                    name="interval_value"
                    min="1"
                    value="5"
                  />
                </div>
                <div class="form-group">
                  <label for="zipIntervalUnit">Interval Unit</label>
                  <select id="zipIntervalUnit" name="interval_unit">
                    <option value="minutes" selected>Minutes</option>
                    <option value="hours">Hours</option>
                    <option value="days">Days</option>
                  </select>
                </div>
              </div>

              <div id="zipCronFields" style="display: none">
                <div class="form-group">
                  <label for="zipCronExpression">Cron Expression</label>
                  <input
                    type="text"
                    id="zipCronExpression"
                    name="cron_expression"
                    placeholder="0 * * * *"
                  />
                  <small
                    >Format: minute hour day month day_of_week (e.g., "0 * * *
                    *" = every hour)</small
                  >
                </div>
              </div>

              <div class="form-group">
                <label for="zipScheduleName">Schedule Name</label>
                <input
                  type="text"
                  id="zipScheduleName"
                  name="schedule_name"
                  placeholder="Daily Report"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="zipDescription">Description</label>
              <textarea
                id="zipDescription"
                name="description"
                rows="3"
                placeholder="What does this app do?"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
          </form>
        </div>

        <!-- Git Upload Tab -->
        <div id="gitTab" class="tab-content">
          <form id="gitUploadForm">
            <div class="form-group">
              <label for="gitUrl">Git Repository URL</label>
              <input
                type="url"
                id="gitUrl"
                name="git_url"
                placeholder="https://github.com/user/repo.git"
                required
              />
            </div>
            <div class="form-group">
              <label for="gitBranch">Branch</label>
              <input type="text" id="gitBranch" name="branch" value="main" />
            </div>
            <div class="form-group">
              <label for="gitAppName">App Name</label>
              <input
                type="text"
                id="gitAppName"
                name="app_name"
                placeholder="my-app"
                required
              />
            </div>
            <div class="form-group">
              <label for="gitDisplayName">Display Name</label>
              <input
                type="text"
                id="gitDisplayName"
                name="display_name"
                placeholder="My Application"
                required
              />
            </div>
            <div class="form-group">
              <label for="gitAppType">App Type</label>
              <select
                id="gitAppType"
                name="app_type"
                required
                onchange="toggleScheduleFields('git')"
              >
                <option value="PERPETUAL" selected>
                  Perpetual (Always Running)
                </option>
                <option value="SCHEDULED">Scheduled (Cron-based)</option>
              </select>
              <small
                >Perpetual apps run continuously, scheduled apps run on a
                schedule</small
              >
            </div>

            <!-- Schedule Fields (for SCHEDULED apps) -->
            <div
              id="gitScheduleFields"
              class="schedule-fields"
              style="display: none"
            >
              <div class="form-group">
                <label for="gitScheduleType">Schedule Type</label>
                <select
                  id="gitScheduleType"
                  name="schedule_type"
                  onchange="toggleScheduleInputs('git')"
                >
                  <option value="interval" selected>
                    Interval (Every X minutes/hours)
                  </option>
                  <option value="cron">Cron Expression (Advanced)</option>
                </select>
              </div>

              <div id="gitIntervalFields">
                <div class="form-group">
                  <label for="gitIntervalValue">Interval Value</label>
                  <input
                    type="number"
                    id="gitIntervalValue"
                    name="interval_value"
                    min="1"
                    value="5"
                  />
                </div>
                <div class="form-group">
                  <label for="gitIntervalUnit">Interval Unit</label>
                  <select id="gitIntervalUnit" name="interval_unit">
                    <option value="minutes" selected>Minutes</option>
                    <option value="hours">Hours</option>
                    <option value="days">Days</option>
                  </select>
                </div>
              </div>

              <div id="gitCronFields" style="display: none">
                <div class="form-group">
                  <label for="gitCronExpression">Cron Expression</label>
                  <input
                    type="text"
                    id="gitCronExpression"
                    name="cron_expression"
                    placeholder="0 * * * *"
                  />
                  <small
                    >Format: minute hour day month day_of_week (e.g., "0 * * *
                    *" = every hour)</small
                  >
                </div>
              </div>

              <div class="form-group">
                <label for="gitScheduleName">Schedule Name</label>
                <input
                  type="text"
                  id="gitScheduleName"
                  name="schedule_name"
                  placeholder="Daily Report"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="gitDescription">Description</label>
              <textarea
                id="gitDescription"
                name="description"
                rows="3"
                placeholder="What does this app do?"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
              Clone & Upload
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- App Details Modal -->
    <div id="appDetailsModal" class="modal">
      <div class="modal-content modal-large">
        <span class="close">&times;</span>
        <div id="appDetailsContent">
          <!-- App details will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Schedule Management Modal -->
    <div id="scheduleModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="scheduleModalTitle">Manage Schedule</h2>
        <form id="scheduleForm">
          <input type="hidden" id="scheduleId" name="schedule_id" />
          <input type="hidden" id="scheduleAppId" name="app_id" />

          <div class="form-group">
            <label for="scheduleName">Schedule Name</label>
            <input
              type="text"
              id="scheduleName"
              name="name"
              placeholder="Daily Report"
              required
            />
          </div>

          <div class="form-group">
            <label for="scheduleDescription">Description</label>
            <textarea
              id="scheduleDescription"
              name="description"
              rows="2"
              placeholder="Optional description"
            ></textarea>
          </div>

          <div class="form-group">
            <label for="scheduleType">Schedule Type</label>
            <select
              id="scheduleType"
              name="schedule_type"
              required
              onchange="toggleScheduleTypeFields()"
            >
              <option value="interval" selected>
                Interval (Every X minutes/hours)
              </option>
              <option value="cron">Cron Expression (Advanced)</option>
            </select>
          </div>

          <div id="intervalFieldsModal">
            <div class="form-group">
              <label for="intervalValue">Interval Value</label>
              <input
                type="number"
                id="intervalValue"
                name="interval_value"
                min="1"
                value="5"
              />
            </div>
            <div class="form-group">
              <label for="intervalUnit">Interval Unit</label>
              <select id="intervalUnit" name="interval_unit">
                <option value="minutes" selected>Minutes</option>
                <option value="hours">Hours</option>
                <option value="days">Days</option>
              </select>
            </div>
          </div>

          <div id="cronFieldsModal" style="display: none">
            <div class="form-group">
              <label for="cronExpression">Cron Expression</label>
              <input
                type="text"
                id="cronExpression"
                name="cron_expression"
                placeholder="0 * * * *"
              />
              <small
                >Format: minute hour day month day_of_week<br />
                Examples: "0 * * * *" (hourly), "0 0 * * *" (daily at midnight),
                "0 9 * * 1-5" (weekdays at 9am)</small
              >
            </div>
          </div>

          <div class="form-group">
            <label>
              <input
                type="checkbox"
                id="scheduleEnabled"
                name="is_enabled"
                checked
              />
              Enable schedule
            </label>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Save Schedule</button>
            <button
              type="button"
              class="btn btn-secondary"
              onclick="closeModal('scheduleModal')"
            >
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>

    <script src="/static/js/main.js?v=4"></script>
  </body>
</html>
